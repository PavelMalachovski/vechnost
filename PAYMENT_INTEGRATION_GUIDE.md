# üí≥ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã Vechnost

## üìã –û–±–∑–æ—Ä

Vechnost –±–æ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —à–ª—é–∑–∞ **Tribute**. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç:

- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏ –ø—Ä–µ–º–∏—É–º —Ç–∞—Ä–∏—Ñ—ã
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tribute API
- ‚úÖ Webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π welcome screen (–∫–∞–∫ —É –•–õ–ë)
- ‚úÖ –ü—Ä–µ–º–∏—É–º —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª
- ‚úÖ –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- ‚úÖ –°–≤—è–∑—å —Å –∞–≤—Ç–æ—Ä–æ–º

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
vechnost_bot/
‚îú‚îÄ‚îÄ payment_models.py          # –ú–æ–¥–µ–ª–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ payment_keyboards.py       # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ payment_handlers.py        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
‚îú‚îÄ‚îÄ subscription_storage.py    # –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–¥–ø–∏—Å–æ–∫
‚îú‚îÄ‚îÄ subscription_middleware.py # Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
‚îú‚îÄ‚îÄ tribute_client.py          # –ö–ª–∏–µ–Ω—Ç Tribute API
‚îî‚îÄ‚îÄ payment_webhook.py         # Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
```

### –¢–∞—Ä–∏—Ñ—ã

#### üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ
- –ë–∞–∑–æ–≤—ã–µ —Ç–µ–º—ã: –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ, –î–ª—è –ü–∞—Ä
- –õ–∏–º–∏—Ç: 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- –ë–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–µ–º–∏—É–º –∫–∞–Ω–∞–ª—É

#### ‚≠ê –ü—Ä–µ–º–∏—É–º —Ç–∞—Ä–∏—Ñ
- **299 ‚ÇΩ/–º–µ—Å—è—Ü** –∏–ª–∏ **2990 ‚ÇΩ/–≥–æ–¥** (—Å–∫–∏–¥–∫–∞ 17%)
- –í—Å–µ —Ç–µ–º—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–≤–∫–ª—é—á–∞—è –°–µ–∫—Å –∏ –ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è)
- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –î–æ—Å—Ç—É–ø –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–º—É –ø—Ä–µ–º–∏—É–º –∫–∞–Ω–∞–ª—É
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–æ–Ω—ã

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Tribute

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Tribute](https://tribute.ru/)
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
3. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ:
   - `API Key`
   - `API Secret`
   - `Webhook Secret`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# Tribute Payment Configuration
TRIBUTE_API_KEY=your_tribute_api_key_here
TRIBUTE_API_SECRET=your_tribute_api_secret_here
TRIBUTE_WEBHOOK_SECRET=your_webhook_secret_here
TRIBUTE_BASE_URL=https://api.tribute.ru

# Premium Channel Configuration
PREMIUM_CHANNEL_ID=@vechnost_premium
PREMIUM_CHANNEL_INVITE_LINK=https://t.me/+your_invite_link

# Contact Configuration
SUPPORT_USERNAME=@vechnost_support
AUTHOR_USERNAME=@your_username

# Enable Payments
PAYMENT_ENABLED=true
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–º–∏—É–º –∫–∞–Ω–∞–ª–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª
2. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –°–æ–∑–¥–∞–π—Ç–µ invite link
4. –£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –≤ `PREMIUM_CHANNEL_INVITE_LINK`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –≤ Tribute

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook URL –≤ Tribute:

```
https://your-domain.com/webhook/tribute
```

**–í–∞–∂–Ω–æ**: –£–∫–∞–∂–∏—Ç–µ `TRIBUTE_WEBHOOK_SECRET` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏.

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞**: `/start`
2. **–í—ã–±–æ—Ä —è–∑—ã–∫–∞**: –†—É—Å—Å–∫–∏–π/English/ƒåe≈°tina
3. **Welcome screen** —Å –∫–Ω–æ–ø–∫–∞–º–∏:
   - üè† –í–û–ô–¢–ò –í VECHNOST
   - üí° –ß–¢–û –¢–ï–ë–Ø –ñ–î–Å–¢ –í–ù–£–¢–†–ò?
   - ‚ù§Ô∏è –ü–û–ß–ï–ú–£ VECHNOST –ü–û–ú–û–ñ–ï–¢?
   - ‚≠ê –û–¢–ó–´–í–´ –û VECHNOST
   - üõ°Ô∏è –ì–ê–†–ê–ù–¢–ò–Ø
   - üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–≤—Ç–æ—Ä–æ–º

4. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º–∞**:
   - –ù–∞–∂–º–∏—Ç–µ "–í–û–ô–¢–ò –í VECHNOST"
   - –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏
   - –û–ø–ª–∞—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Tribute
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –∫–æ–¥–µ

```python
from .subscription_middleware import check_and_enforce_subscription

# –í –≤–∞—à–µ–º handler
has_access = await check_and_enforce_subscription(query, session, theme)
if not has_access:
    return  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
from .subscription_storage import get_subscription_storage

storage = get_subscription_storage()
subscription = await storage.get_subscription(user_id)

if subscription.is_active():
    print(f"Premium active, {subscription.days_remaining()} days left")
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

```python
from .tribute_client import get_tribute_client

tribute = get_tribute_client()
payment_link = await tribute.create_payment_link(
    amount=299.0,
    currency="RUB",
    description="Vechnost Premium - –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞",
    user_id=user_id,
    metadata={"plan": "monthly"}
)

print(f"Payment URL: {payment_link.payment_url}")
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook –ø–æ–¥–ø–∏—Å–∏

```python
from .tribute_client import get_tribute_client

tribute = get_tribute_client()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏–∑ header
is_valid = tribute.verify_webhook_signature(
    payload=request_body,
    signature=request.headers.get("X-Tribute-Signature")
)

if not is_valid:
    return {"error": "Invalid signature"}, 403
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

- –í—Å–µ –ø—Ä–µ–º–∏—É–º —Ç–µ–º—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ middleware
- –õ–∏–º–∏—Ç—ã –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è:

```python
- payment_created        # –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω
- payment_completed      # –ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω
- payment_failed         # –ü–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª
- subscription_upgraded  # –ü–æ–¥–ø–∏—Å–∫–∞ —É–ª—É—á—à–µ–Ω–∞
- subscription_renewed   # –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∞
- subscription_cancelled # –ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```python
from .subscription_storage import get_subscription_storage

storage = get_subscription_storage()

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
payments = await storage.get_user_payments(user_id)

for payment in payments:
    print(f"Payment: {payment.amount} RUB - {payment.status}")
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏

Tribute –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```bash
TRIBUTE_BASE_URL=https://sandbox.tribute.ru
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
PAYMENT_ENABLED=false
```

–ü—Ä–∏ `PAYMENT_ENABLED=false` –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø.

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `vechnost_bot/payment_models.py`:

```python
SubscriptionPlan(
    tier=SubscriptionTier.PREMIUM,
    name="–ü—Ä–µ–º–∏—É–º",
    description="‚≠ê –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ç–µ–º–∞–º + —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–∞–Ω–∞–ª",
    price_monthly=299.0,  # –ò–∑–º–µ–Ω–∏—Ç–µ –∑–¥–µ—Å—å
    price_yearly=2990.0,  # –ò–∑–º–µ–Ω–∏—Ç–µ –∑–¥–µ—Å—å
    # ...
)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `data/translations_ru.yaml`:

```yaml
welcome:
  enter_vechnost: "–í–û–ô–¢–ò –í VECHNOST ‚Üê"
  # –ò–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç—ã –∑–¥–µ—Å—å
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–µ–º–∏—É–º–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `payment_models.py`:

```python
class SubscriptionFeatures(BaseModel):
    basic_themes: bool = True
    premium_themes: bool = False

    # –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    custom_questions: bool = False
    ai_suggestions: bool = False
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü–ª–∞—Ç–µ–∂–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook URL –≤ Tribute
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TRIBUTE_WEBHOOK_SECRET` —Å–æ–≤–ø–∞–¥–∞–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `grep "webhook" logs/bot.log`

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: `redis-cli GET subscription:{user_id}`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `PAYMENT_ENABLED=true`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏

### –û—à–∏–±–∫–∏ Tribute API

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API keys
echo $TRIBUTE_API_KEY

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -H "Authorization: Bearer $TRIBUTE_API_KEY" \
     https://api.tribute.ru/v1/payments
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- üìß Email: support@vechnost.app
- üí¨ Telegram: @vechnost_support
- üêõ Issues: [GitHub Issues](https://github.com/your-repo/issues)

---

## üìù Changelog

### v2.0.0 (2025-10-11)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tribute
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ Free/Premium
- ‚úÖ Welcome screen –∫–∞–∫ —É –•–õ–ë
- ‚úÖ –ü—Ä–µ–º–∏—É–º —Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª
- ‚úÖ Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. LICENSE —Ñ–∞–π–ª

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è Vechnost**

