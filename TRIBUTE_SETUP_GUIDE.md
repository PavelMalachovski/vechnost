# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Tribute –¥–ª—è Telegram –±–æ—Ç–∞

## –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Tribute

1. **–ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç Tribute**: https://tribute.ru/
2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å** –∫–∞–∫ –ø—Ä–æ–¥–∞–≤–µ—Ü/–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å
3. **–ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é** (–∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ò–ü/–û–û–û)
4. **–î–æ–∂–¥–∏—Ç–µ—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è** –∞–∫–∫–∞—É–Ω—Ç–∞ (–æ–±—ã—á–Ω–æ 1-3 –¥–Ω—è)

## –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

–ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞:

1. –ó–∞–π–¥–∏—Ç–µ –≤ **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Tribute**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"API"**
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π **API –∫–ª—é—á**:
   - –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á"
   - –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞: `payments.read`, `payments.write`, `subscriptions.read`, `subscriptions.write`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ **API Key** –∏ **API Secret** –≤ –Ω–∞–¥–µ–∂–Ω–æ–µ –º–µ—Å—Ç–æ

4. –í —Ä–∞–∑–¥–µ–ª–µ **"Webhooks"** —Å–æ–∑–¥–∞–π—Ç–µ webhook:
   - URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/tribute`
   - –°–µ–∫—Ä–µ—Ç webhook: —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `openssl rand -hex 32`)
   - –°–æ–±—ã—Ç–∏—è: –≤—ã–±–µ—Ä–∏—Ç–µ `payment.succeeded`, `subscription.activated`, `subscription.renewed`, `subscription.canceled`

## –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤/–ø–æ–¥–ø–∏—Å–æ–∫ –≤ Tribute

1. –í –ø–∞–Ω–µ–ª–∏ Tribute –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"–¢–æ–≤–∞—Ä—ã"** ‚Üí **"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"**
2. –°–æ–∑–¥–∞–π—Ç–µ **–¥–≤–∞ —Ç–∞—Ä–∏—Ñ–∞**:

### –¢–∞—Ä–∏—Ñ "–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞"
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: Vechnost Premium (1 –º–µ—Å—è—Ü)
- **–¶–µ–Ω–∞**: 299 ‚ÇΩ
- **–¢–∏–ø**: –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ –∏–ª–∏ –ü–æ–¥–ø–∏—Å–∫–∞
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ç–µ–º–∞–º –∏ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–∞ 1 –º–µ—Å—è—Ü
- **ID —Ç–æ–≤–∞—Ä–∞**: –∑–∞–ø–æ–º–Ω–∏—Ç–µ/—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `prod_monthly_299`)

### –¢–∞—Ä–∏—Ñ "–ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞"
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: Vechnost Premium (1 –≥–æ–¥)
- **–¶–µ–Ω–∞**: 2990 ‚ÇΩ
- **–¢–∏–ø**: –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ –∏–ª–∏ –ü–æ–¥–ø–∏—Å–∫–∞
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ç–µ–º–∞–º –∏ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–∞ 1 –≥–æ–¥ (—ç–∫–æ–Ω–æ–º–∏—è 33%)
- **ID —Ç–æ–≤–∞—Ä–∞**: –∑–∞–ø–æ–º–Ω–∏—Ç–µ/—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `prod_yearly_2990`)

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±–æ—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# Tribute API
TRIBUTE_API_KEY=your_tribute_api_key
TRIBUTE_API_SECRET=your_tribute_api_secret
TRIBUTE_WEBHOOK_SECRET=your_generated_webhook_secret
TRIBUTE_BASE_URL=https://api.tribute.ru

# Payment Configuration
PAYMENT_ENABLED=true

# Support
AUTHOR_USERNAME=your_telegram_username
SUPPORT_USERNAME=your_support_username

# Monitoring (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
SENTRY_DSN=your_sentry_dsn
```

## –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook URL

–í–∞—à –±–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è webhook –æ—Ç Tribute.

### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ngrok –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
ngrok http 8000

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://abc123.ngrok.io)
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –∫–∞–∫ webhook URL: https://abc123.ngrok.io/webhook/tribute
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

1. **Railway.app** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```bash
   railway login
   railway up
   # Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–∞—Å—Ç –≤–∞–º URL
   ```

2. **Heroku**:
   ```bash
   heroku create your-app-name
   git push heroku main
   # URL: https://your-app-name.herokuapp.com
   ```

3. **VPS/Dedicated Server**:
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx/Apache –∫–∞–∫ reverse proxy
   - –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
   - URL: https://yourdomain.com

## –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Tribute —Å webhook URL

1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ **Tribute Dashboard** ‚Üí **"Webhooks"**
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤–∞—à webhook
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **URL**: `https://your-actual-domain.com/webhook/tribute`
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–±—Ä–∞–Ω—ã —Å–æ–±—ã—Ç–∏—è:
   - `payment.succeeded`
   - `subscription.activated`
   - `subscription.renewed`
   - `subscription.canceled`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

## –®–∞–≥ 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ Product ID

–û—Ç–∫—Ä–æ–π—Ç–µ `vechnost_bot/tribute_client.py` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö Product ID –∏–∑ Tribute:

```python
# –í –º–µ—Ç–æ–¥–µ create_payment_link –∏–ª–∏ create_subscription
# –í–º–µ—Å—Ç–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ product_id
payload = {
    "product_id": "prod_monthly_299",  # ‚Üê –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID –∏–∑ Tribute
    "success_url": success_url,
    "fail_url": fail_url,
    "webhook_url": webhook_url,
    "metadata": metadata,
}
```

## –®–∞–≥ 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**:
   ```bash
   python -m vechnost_bot
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram**
3. **–ù–∞–∂–º–∏—Ç–µ "–£–ª—É—á—à–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"**
4. **–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ** (–º–µ—Å—è—á–Ω—ã–π/–≥–æ–¥–æ–≤–æ–π)
5. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –æ–ø–ª–∞—Ç—ã**

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Tribute:
- **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞**: `4111 1111 1111 1111`
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞**: `4242 4242 4242 4242`
- CVV: –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã
- –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞

## –®–∞–≥ 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤–æ–π –æ–ø–ª–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞:

```bash
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
[INFO] Received Tribute webhook event
[INFO] Tribute webhook event: payment.succeeded
[INFO] User 123456789 subscription updated to PREMIUM via webhook
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Tribute Dashboard ‚Üí **"Webhooks"** ‚Üí **"–ò—Å—Ç–æ—Ä–∏—è"**:
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –æ–± –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö webhook
- –°—Ç–∞—Ç—É—Å: 200 OK

## –®–∞–≥ 10: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

1. **–õ–æ–≥–∏ –±–æ—Ç–∞**: —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏
2. **Tribute Dashboard**: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
3. **Redis**: —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## Troubleshooting

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS (Tribute —Ç—Ä–µ–±—É–µ—Ç SSL)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ webhook secret –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –û–ø–ª–∞—Ç–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ metadata –≤ –ø–ª–∞—Ç–µ–∂–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å user_id)

### –û—à–∏–±–∫–∞ "Invalid signature"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ TRIBUTE_WEBHOOK_SECRET —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ–∫—Ä–µ—Ç–æ–º –≤ Tribute

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Tribute API Docs**: https://docs.tribute.ru/
- **Telegram Bot API**: https://core.telegram.org/bots/api
- **Python Telegram Bot Library**: https://python-telegram-bot.org/

---

‚úÖ **–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤–∞—à –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Tribute.


