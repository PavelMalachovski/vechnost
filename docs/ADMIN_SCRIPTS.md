# ๐๏ธ ะะดะผะธะฝัะบะธะต ัะบัะธะฟัั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟะพะดะฟะธัะบะฐะผะธ

## ะะพัััะฟะฝัะต ัะบัะธะฟัั

| ะกะบัะธะฟั | ะะฐะทะฝะฐัะตะฝะธะต | ะัะฟะพะปัะทะพะฒะฐะฝะธะต |
|--------|-----------|---------------|
| `list_users.py` | ะกะฟะธัะพะบ ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน | `python list_users.py` |
| `check_user_payment.py` | ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต | `python check_user_payment.py USER_ID` |
| `activate_user.py` | ะััะฝะฐั ะฐะบัะธะฒะฐัะธั ะฟะพะดะฟะธัะบะธ | `python activate_user.py USER_ID [DAYS]` |
| `sync_products.py` | ะกะธะฝััะพะฝะธะทะฐัะธั ะฟัะพะดัะบัะพะฒ ั Tribute | `python sync_products.py` |

---

## 1. ะัะพัะผะพัั ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

### ะะพะผะฐะฝะดะฐ:
```bash
python list_users.py
```

### ะัะฒะพะด:
```
================================================================================
ALL USERS IN DATABASE
================================================================================

Total users: 3

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. โ User ID: 1115719673
   Name: ะะฐัะธั ะะฒะฐะฝะพะฒะฐ
   Username: @maria_ivanova
   Registered: 2025-10-12 20:30
   ๐ Active subscriptions: 1
      โ Expires in 29 days (2025-11-11)

2. โ User ID: 540529430
   Name: ะะฝะดัะตะน ะะตััะพะฒ
   Registered: 2025-10-12 22:15
   ๐ No active subscriptions

3. โ User ID: 542528637
   Name: Test User
   Username: @testuser
   Registered: 2025-10-12 22:30
   ๐ Active subscriptions: 1
      โ Expires in 364 days (2026-10-11)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

SUMMARY:
  Total users: 3
  With access: 2
  Without access: 1

================================================================================
```

---

## 2. ะัะพะฒะตัะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั

### ะะพะผะฐะฝะดะฐ:
```bash
python check_user_payment.py 1115719673
```

### ะงัะพ ะฟะพะบะฐะทัะฒะฐะตั:
- โ ะะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั (ะธะผั, username, ะดะฐัะฐ ัะตะณะธัััะฐัะธะธ)
- ๐ ะัะต ะฟะพะดะฟะธัะบะธ (ะฐะบัะธะฒะฝัะต ะธ ะฝะตะฐะบัะธะฒะฝัะต)
- ๐ณ ะัะต ะฟะปะฐัะตะถะธ
- ๐ ะะพัะปะตะดะฝะธะต ะฒะตะฑััะบะธ ะพั Tribute
- ๐ ะัะพะณะพะฒัะน ััะฐััั ะดะพัััะฟะฐ

### ะัะธะผะตั ะฒัะฒะพะดะฐ:
```
============================================================
Checking user: 1115719673
============================================================

โ USER FOUND:
   ID: 1
   Telegram ID: 1115719673
   Username: @maria_ivanova
   Name: ะะฐัะธั ะะฒะฐะฝะพะฒะฐ
   Created: 2025-10-12 20:30:00

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ SUBSCRIPTIONS (1):

   โ Subscription ID: 1
      Tribute ID: sub_abc123
      Status: active
      Starts: 2025-10-12 22:30:00
      Ends: 2025-11-12 22:30:00
      Created: 2025-10-12 22:30:00

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ณ PAYMENTS (1):

   โ Payment ID: 1
      Tribute ID: pay_xyz789
      Amount: 999 RUB
      Status: succeeded
      Created: 2025-10-12 22:30:00

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ RECENT WEBHOOK EVENTS (2):

   โ Event ID: 1
      Type: subscription.created
      Tribute ID: evt_111
      Processed: True
      Created: 2025-10-12 22:30:00

   โ Event ID: 2
      Type: payment.succeeded
      Tribute ID: evt_222
      Processed: True
      Created: 2025-10-12 22:30:15

============================================================
๐ RESULT: USER HAS ACTIVE ACCESS โ
============================================================
```

---

## 3. ะััะฝะฐั ะฐะบัะธะฒะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:
- ะะฟะปะฐัะฐ ะฟัะพัะปะฐ ะฝะฐ ััะพัะพะฝะต Tribute, ะฝะพ ะฒะตะฑััะบ ะฝะต ะฟัะธััะป
- ะัะถะฝะพ ะดะฐัั ัะตััะพะฒัะน ะดะพัััะฟ
- ะะพะปัะทะพะฒะฐัะตะปั ะพะฟะปะฐัะธะป ะฝะฐะฟััะผัั (ะฝะต ัะตัะตะท Tribute)
- ะัะพะผะพ-ะฐะบัะธั ะธะปะธ ะฟะพะดะฐัะพัะฝะฐั ะฟะพะดะฟะธัะบะฐ

### ะะพะผะฐะฝะดั:

#### ะะบัะธะฒะฐัะธั ะฝะฐ 30 ะดะฝะตะน (ะฟะพ ัะผะพะปัะฐะฝะธั):
```bash
python activate_user.py 1115719673
```

#### ะะบัะธะฒะฐัะธั ะฝะฐ 7 ะดะฝะตะน (ะฟัะพะฑะฝัะน ะฟะตัะธะพะด):
```bash
python activate_user.py 1115719673 7
```

#### ะะบัะธะฒะฐัะธั ะฝะฐ 1 ะณะพะด:
```bash
python activate_user.py 1115719673 365
```

#### ะะบัะธะฒะฐัะธั ะฝะฐะฒัะตะณะดะฐ (ะธะปะธ ะฝะฐ ะผะฝะพะณะพ ะปะตั):
```bash
python activate_user.py 1115719673 36500  # 100 ะปะตั
```

### ะัะฒะพะด:
```
Activating user 1115719673 for 30 days...
โ Found user: ะะฐัะธั ะะฒะฐะฝะพะฒะฐ

โ๏ธ  User already has 1 active subscription(s):
   - Ends: 2025-11-12 22:30:00

Deactivate existing subscriptions? (y/n): y
   Deactivated existing subscriptions.

โ SUBSCRIPTION ACTIVATED!
   Subscription ID: 2
   Start: 2025-10-12 22:35:00
   End: 2025-11-11 22:35:00
   Duration: 30 days

๐ User 1115719673 now has access to the bot!
```

---

## 4. ะกะธะฝััะพะฝะธะทะฐัะธั ะฟัะพะดัะบัะพะฒ ั Tribute

### ะะพะผะฐะฝะดะฐ:
```bash
python sync_products.py
```

### ะงัะพ ะดะตะปะฐะตั:
- ะะพะปััะฐะตั ัะฟะธัะพะบ ะฟัะพะดัะบัะพะฒ/ะฟะพะดะฟะธัะพะบ ะธะท Tribute API
- ะกะพััะฐะฝัะตั ะธั ะฒ ะะ
- ะะฑะฝะพะฒะปัะตั ัััะปะบะธ ะดะปั ะพะฟะปะฐัั ะฒ ะฑะพัะต

### ะขัะตะฑะพะฒะฐะฝะธั:
- `TRIBUTE_API_KEY` ะดะพะปะถะตะฝ ะฑััั ัััะฐะฝะพะฒะปะตะฝ
- ะะฝัะตัะฝะตั-ัะพะตะดะธะฝะตะฝะธะต ั Tribute API

### ะัะฒะพะด:
```
Syncing products from Tribute...
โ Synced 3 products successfully!

Products in database:
  1. Monthly Subscription - 999 RUB
  2. Annual Subscription - 9990 RUB
  3. Lifetime Access - 29990 RUB
```

---

## ะะฐะฟััะบ ะฝะฐ Railway

ะัะต ััะธ ัะบัะธะฟัั ะผะพะถะฝะพ ะทะฐะฟััะบะฐัั ะฝะฐ Railway:

### 1. ะัะบัะพะนัะต Railway Shell:
```
Railway โ ะะฐั ะฟัะพะตะบั โ Shell (ะธะบะพะฝะบะฐ ัะตัะผะธะฝะฐะปะฐ)
```

### 2. ะะฐะฟัััะธัะต ะฝัะถะฝัะน ัะบัะธะฟั:
```bash
# ะกะฟะธัะพะบ ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
python list_users.py

# ะัะพะฒะตัะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
python check_user_payment.py 1115719673

# ะะบัะธะฒะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
python activate_user.py 1115719673 30

# ะกะธะฝััะพะฝะธะทะฐัะธั ะฟัะพะดัะบัะพะฒ
python sync_products.py
```

---

## ะขะธะฟะธัะฝัะต ััะตะฝะฐัะธะธ

### ะกัะตะฝะฐัะธะน 1: ะะพะปัะทะพะฒะฐัะตะปั ะณะพะฒะพัะธั "ั ะพะฟะปะฐัะธะป, ะฝะพ ะฑะพั ะฝะต ะฟััะบะฐะตั"

```bash
# 1. ะัะพะฒะตััะตะผ ะฟะพะปัะทะพะฒะฐัะตะปั
python check_user_payment.py 1115719673

# 2. ะกะผะพััะธะผ ัะตะทัะปััะฐั:
#    - ะัะปะธ "USER HAS ACCESS โ" โ ะฟะพะฟัะพัะธัั ะฝะฐะถะฐัั "ะัะพะฒะตัะธัั ััะฐััั"
#    - ะัะปะธ "USER DOES NOT HAVE ACCESS โ" โ ัะผะพััะธะผ ะฟะพะดะฟะธัะบะธ ะธ ะฟะปะฐัะตะถะธ
#    - ะัะปะธ ะฟะพะดะฟะธัะพะบ ะฝะตั โ ะฐะบัะธะฒะธััะตะผ ะฒัััะฝัั

# 3. ะะบัะธะฒะธััะตะผ ะฒัััะฝัั (ะตัะปะธ ะฝัะถะฝะพ)
python activate_user.py 1115719673 30

# 4. ะัะพัะธะผ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟัะพะฒะตัะธัั ะฒ ะฑะพัะต
```

### ะกัะตะฝะฐัะธะน 2: ะะฐััะพะฒะฐั ะฟัะพะฒะตัะบะฐ ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

```bash
# ะกะผะพััะธะผ ัะฟะธัะพะบ ะฒัะตั
python list_users.py

# ะัะพะฒะตััะตะผ ะฟะพะดะพะทัะธัะตะปัะฝัั ะดะตัะฐะปัะฝะพ
python check_user_payment.py USER_ID
```

### ะกัะตะฝะฐัะธะน 3: ะัะพะผะพ-ะฐะบัะธั (ะฑะตัะฟะปะฐัะฝัะน ะดะพัััะฟ ะฝะฐ ะฝะตะดะตะปั)

```bash
# ะะปั ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
python activate_user.py 1115719673 7

# ะะปั ะฝะตัะบะพะปัะบะธั - ะฟะพะฒัะพััะตะผ ะบะพะผะฐะฝะดั
python activate_user.py 540529430 7
python activate_user.py 542528637 7
```

### ะกัะตะฝะฐัะธะน 4: ะะฑะฝะพะฒะปะตะฝะธะต ัะฟะธัะบะฐ ะฟัะพะดัะบัะพะฒ

```bash
# ะะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒะพะณะพ ะฟัะพะดัะบัะฐ ะฒ Tribute
python sync_products.py

# ะัะพะฒะตััะตะผ, ััะพ ะฟัะพะดัะบัั ะพะฑะฝะพะฒะธะปะธัั
python list_users.py  # ะะปะธ ัะผะพััะธะผ ะฒ ะะ
```

---

## ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะบะพะผะฐะฝะดั

### ะััะผะพะน SQL ะทะฐะฟัะพั ะบ ะะ:

```bash
python -c "
import asyncio
from vechnost_bot.payments.database import get_db

async def query():
    async with get_db() as session:
        result = await session.execute('SELECT COUNT(*) FROM users')
        count = result.scalar()
        print(f'Total users: {count}')

asyncio.run(query())
"
```

### ะะฐััะพะฒะฐั ะดะตะฐะบัะธะฒะฐัะธั:

```bash
python -c "
import asyncio
from vechnost_bot.payments.database import get_db
from sqlalchemy import update
from vechnost_bot.payments.models import Subscription
from datetime import datetime

async def deactivate_all():
    async with get_db() as session:
        await session.execute(
            update(Subscription)
            .where(Subscription.status == 'active')
            .values(status='cancelled', end_date=datetime.utcnow())
        )
        await session.commit()
        print('All subscriptions deactivated')

asyncio.run(deactivate_all())
"
```

---

## ะะตะทะพะฟะฐัะฝะพััั

โ๏ธ **ะะะะะ:**

1. **ะะต ะดะตะปะธัะตัั ะะ** - ัะฐะนะป `vechnost.db` ัะพะดะตัะถะธั ะปะธัะฝัะต ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน
2. **ะะต ะบะพะผะผะธัััะต ะะ** - ัะฐะนะป ัะถะต ะฒ `.gitignore`
3. **ะะตะทะตัะฒะฝัะต ะบะพะฟะธะธ** - ะดะตะปะฐะนัะต ะฑัะบะฐะฟั ะะ ัะตะณัะปััะฝะพ:
   ```bash
   # ะะฐ Railway
   cp vechnost.db vechnost.db.backup.$(date +%Y%m%d)
   ```
4. **ะะพะณะธ ะฐะบัะธะฒะฐัะธะธ** - ะฒัะต ะดะตะนััะฒะธั ะฐะดะผะธะฝัะบะธั ัะบัะธะฟัะพะฒ ะพััะฐะฒะปััั ัะปะตะด ะฒ ะะ

---

## ะฃัััะฐะฝะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะธะฑะบะฐ "no such table: users"

**ะัะธัะธะฝะฐ**: ะะ ะฝะต ะธะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝะฐ

**ะะตัะตะฝะธะต**:
```bash
# ะะฐะฟัััะธัะต ะฑะพัะฐ ะพะดะธะฝ ัะฐะท, ััะพะฑั ัะพะทะดะฐะปะธัั ัะฐะฑะปะธัั
# ะะปะธ ะฟัะธะฝัะดะธัะตะปัะฝะพ ัะพะทะดะฐะนัะต:
python -c "
import asyncio
from vechnost_bot.payments.database import create_tables
asyncio.run(create_tables())
"
```

### ะัะธะฑะบะฐ "User not found"

**ะัะธัะธะฝะฐ**: ะะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฒะทะฐะธะผะพะดะตะนััะฒะพะฒะฐะป ั ะฑะพัะพะผ

**ะะตัะตะฝะธะต**: ะะพะฟัะพัะธัั ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะฐัั `/start` ะฒ ะฑะพัะต

### ะกะบัะธะฟัั ะฝะต ัะฐะฑะพัะฐัั ะปะพะบะฐะปัะฝะพ

**ะัะธัะธะฝะฐ**: ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฝะต ัััะฐะฝะพะฒะปะตะฝั

**ะะตัะตะฝะธะต**:
```bash
# ะกะพะทะดะฐะนัะต .env ัะฐะนะป ั ะฝัะถะฝัะผะธ ะฟะตัะตะผะตะฝะฝัะผะธ
cp env.example .env
# ะััะตะดะฐะบัะธััะนัะต .env
```

---

**ะะพัะพะฒะพ! ะัะฟะพะปัะทัะนัะต ััะธ ัะบัะธะฟัั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะธ ะฟะพะดะฟะธัะบะฐะผะธ.** ๐

