# Troubleshooting Payment Integration

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω `/about`
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/about` –Ω–∞ 3 —è–∑—ã–∫–∞—Ö (RU, EN, CS)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ, –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –•–õ–ë
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –¥–ª—è –∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞
- ‚úÖ –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã
- ‚úÖ –ï—Å–ª–∏ `ENABLE_PAYMENT=TRUE` –∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ Railway

### –ü—Ä–æ–±–ª–µ–º–∞: "–ë–æ—Ç –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–± –æ–ø–ª–∞—Ç–µ"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `ENABLE_PAYMENT` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ `FALSE`

### ‚úÖ –†–µ—à–µ–Ω–∏–µ:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard** ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí Variables

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `ENABLE_PAYMENT`**:
   - ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**: –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, `false`, `False`, `0`
   - ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ**: `TRUE`, `true`, `1`

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**:
   ```
   ENABLE_PAYMENT=TRUE
   ```
   –∏–ª–∏
   ```
   ENABLE_PAYMENT=true
   ```

4. **–í–∞–∂–Ω–æ**: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –æ–ø–ª–∞—Ç—ã:

```
ENABLE_PAYMENT=TRUE                  # ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å TRUE
TRIBUTE_API_KEY=trib_xxxxx          # ‚úÖ –í–∞—à API –∫–ª—é—á
WEBHOOK_SECRET=whsec_xxxxx          # ‚úÖ –°–µ–∫—Ä–µ—Ç –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤  
DATABASE_URL=sqlite:///./vechnost.db # ‚úÖ –ü—É—Ç—å –∫ –ë–î
```

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
# –í –ª–æ–≥–∞—Ö Railway –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
Application created with handlers:
- Command handlers: start, help, reset, about
```

### –®–∞–≥ 2: –ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é —Å –±–æ—Ç–æ–º
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
2. –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫
3. **–î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —ç–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã** —Å –∫–Ω–æ–ø–∫–∞–º–∏:
   - üí≥ –ö—É–ø–∏—Ç—å –¥–æ—Å—Ç—É–ø
   - üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã

### –®–∞–≥ 3: –ï—Å–ª–∏ —ç–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã –ù–ï –ø–æ—è–≤–∏–ª—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `ENABLE_PAYMENT=TRUE` –≤ Railway
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç –≤ Railway
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:
- `/start` - –ù–∞—á–∞—Ç—å –∏–≥—Ä—É (–≤—ã–±–æ—Ä —è–∑—ã–∫–∞)
- `/about` - **–ù–û–í–û–ï** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
- `/help` - –ü–æ–º–æ—â—å
- `/reset` - –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É

## üéØ –ö–∞–∫ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–ª–æ—É —Å –æ–ø–ª–∞—Ç–æ–π

### –° –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π (`ENABLE_PAYMENT=TRUE`):

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/start`
2. –ë–æ—Ç: –í—ã–±–æ—Ä —è–∑—ã–∫–∞
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫ (RU)
4. **–ë–æ—Ç: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–ø–ª–∞—Ç—É**
   - ‚ùå –ù–µ—Ç –æ–ø–ª–∞—Ç—ã ‚Üí –≠–∫—Ä–∞–Ω "üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø"
   - ‚úÖ –ï—Å—Ç—å –æ–ø–ª–∞—Ç–∞ ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–∞–∂–∏–º–∞–µ—Ç "üí≥ –ö—É–ø–∏—Ç—å –¥–æ—Å—Ç—É–ø"
6. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ Tribute –¥–ª—è –æ–ø–ª–∞—Ç—ã
7. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã ‚Üí webhook ‚Üí –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã"
9. –ë–æ—Ç: "‚úÖ –î–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω!"
10. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ç–µ–º—ã

### –ë–µ–∑ –æ–ø–ª–∞—Ç—ã (`ENABLE_PAYMENT=FALSE`):

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/start`
2. –ë–æ—Ç: –í—ã–±–æ—Ä —è–∑—ã–∫–∞
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫
4. –ë–æ—Ç: –°—Ä–∞–∑—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏)
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ç–µ–º—ã

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 1: "AttributeError: 'CallbackHandlerRegistry' object has no attribute 'register'"
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: CheckPaymentHandler —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `__init__`

### –û—à–∏–±–∫–∞ 2: "–ë–æ—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–ø–ª–∞—Ç—É"
- ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**: `ENABLE_PAYMENT` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `TRUE`
- ‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `ENABLE_PAYMENT=TRUE` –≤ Railway Variables

### –û—à–∏–±–∫–∞ 3: "Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
- ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**: Webhook server –Ω–µ –∑–∞–ø—É—â–µ–Ω
- ‚úÖ **–†–µ—à–µ–Ω–∏–µ**: 
  ```bash
  python run_webhook_server.py
  ```
  –ò –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ URL –≤ Tribute Dashboard

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î:

```python
# –õ–æ–∫–∞–ª—å–Ω–æ:
sqlite3 vechnost.db
SELECT * FROM users;
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å —Å `telegram_user_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] `ENABLE_PAYMENT=TRUE` –≤ Railway Variables
- [ ] `TRIBUTE_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- [ ] `WEBHOOK_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] Webhook server –∑–∞–ø—É—â–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ)
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: `alembic upgrade head`
- [ ] –ü—Ä–æ–¥—É–∫—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã: `python sync_products.py`

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
python -c "from vechnost_bot.payments.services import user_has_access; print('OK')"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ ENABLE_PAYMENT
python -c "from vechnost_bot.config import settings; print(f'ENABLE_PAYMENT={settings.enable_payment}')"

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
alembic upgrade head

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
python sync_products.py

# –ó–∞–ø—É—Å—Ç–∏—Ç—å webhook server
python run_webhook_server.py
```

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway –Ω–∞ –æ—à–∏–±–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å deployment –≤ Railway
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `aiosqlite` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è async SQLite

## ‚ú® –ò—Ç–æ–≥–æ

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `ENABLE_PAYMENT=TRUE`:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –æ–ø–ª–∞—Ç—ã —É–≤–∏–¥—è—Ç —ç–∫—Ä–∞–Ω "üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø"
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/about` –ø–æ–∫–∞–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ –Ω–∞ 3 —è–∑—ã–∫–∞—Ö
- ‚úÖ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Tribute –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –¥–æ—Å—Ç—É–ø
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã"

